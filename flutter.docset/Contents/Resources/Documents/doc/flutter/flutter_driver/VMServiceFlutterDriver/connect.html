<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no"/>
  <meta name="description" content="API docs for the connect method from the VMServiceFlutterDriver class, for the Dart programming language."/>
  <title>connect method - VMServiceFlutterDriver class - flutter_driver library - Dart API</title>

  <!-- required because all the links are pseudo-absolute -->
  <base href="../../"/>

  
  <link rel="preconnect" href="https://fonts.gstatic.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&amp;display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" rel="stylesheet"/>
  
  <link rel="stylesheet" href="static-assets/github.css?v1"/>
  <link rel="stylesheet" href="static-assets/styles.css?v1"/>
  <link rel="icon" href="static-assets/favicon.png?v1"/>

  <!-- style overrides for dartdoc -->
<style>
@import 'https://fonts.googleapis.com/css?family=Roboto:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Google+Sans:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Open+Sans:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Sharp|Material+Icons+Round';
</style>

<link href="https://flutter.github.io/assets-for-api-docs/assets/cupertino/cupertino.css" rel="stylesheet" type="text/css"/>

<link href="../assets/overrides.css" rel="stylesheet" type="text/css"/>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Sharp|Material+Icons+Round" rel="stylesheet"/>
<style>
  /* Rule for sizing the icon. */
  .md-36 { font-size: 36px; }
</style>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67589403-1', 'auto');
  ga('send', 'pageview');
</script>

<script async="" defer="" src="../assets/api_survey.js"></script>

<!-- Styles and scripting for handling custom code snippets -->
<link href="../assets/snippets.css" rel="stylesheet" type="text/css"/>
<script src="../assets/snippets.js"></script>

<link rel="search" type="application/opensearchdescription+xml" title="Flutter API" href="opensearch.xml"/>

</head>


<body data-base-href="../../" data-using-base-href="true" class="light-theme">

<div id="overlay-under-drawer"></div>

<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="index.html">Flutter</a></li>
    <li><a href="flutter_driver/flutter_driver-library.html">flutter_driver</a></li>
    <li><a href="flutter_driver/VMServiceFlutterDriver-class.html">VMServiceFlutterDriver</a></li>
    <li class="self-crumb">connect static method</li>
  </ol>
  <div class="self-name">connect</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled="" class="form-control typeahead" placeholder="Loading search..."/>
  </form>
  <div class="toggle" id="theme-button">
    <label for="theme">
      <input type="checkbox" id="theme" value="light-theme"/>
      <span class="material-symbols-outlined">
        brightness_4
      </span>
    </label>
  </div>
</header>
<main>

  <div id="dartdoc-main-content" class="main-content">
      <div>
  <div id="external-links" class="btn-group"><a title="View source code" class="source-link" href="https://github.com/flutter/flutter/blob/master/packages/flutter_driver/lib/src/driver/vmservice_driver.dart#L36"><span class="material-symbols-outlined">description</span></a></div>
<h1><a class="dashingAutolink" name="autolink-16756"></a><a class="dashAnchor" name="//apple_ref/cpp/Method/connect"></a><span class="kind-method">connect</span> static method 
    <a href="https://dart.dev/null-safety" class="feature feature-null-safety" title="Supports the null safety language feature.">Null safety</a>
</h1></div>

    <section class="multi-line-signature">
      

<span class="returntype"><a href="dart-async/Future-class.html">Future</a><span class="signature">&lt;<wbr/><span class="type-parameter"><a href="flutter_driver/FlutterDriver-class.html">FlutterDriver</a></span>&gt;</span></span>
<span class="name ">connect</span>(<wbr/><ol class="parameter-list"><li><span class="parameter" id="connect-param-dartVmServiceUrl">{<span class="type-annotation"><a href="dart-core/String-class.html">String</a>?</span> <span class="parameter-name">dartVmServiceUrl</span>, </span></li>
<li><span class="parameter" id="connect-param-printCommunication"><span class="type-annotation"><a href="dart-core/bool-class.html">bool</a></span> <span class="parameter-name">printCommunication</span> = <span class="default-value">false</span>, </span></li>
<li><span class="parameter" id="connect-param-logCommunicationToFile"><span class="type-annotation"><a href="dart-core/bool-class.html">bool</a></span> <span class="parameter-name">logCommunicationToFile</span> = <span class="default-value">true</span>, </span></li>
<li><span class="parameter" id="connect-param-isolateNumber"><span class="type-annotation"><a href="dart-core/int-class.html">int</a>?</span> <span class="parameter-name">isolateNumber</span>, </span></li>
<li><span class="parameter" id="connect-param-fuchsiaModuleTarget"><span class="type-annotation"><a href="dart-core/Pattern-class.html">Pattern</a>?</span> <span class="parameter-name">fuchsiaModuleTarget</span>, </span></li>
<li><span class="parameter" id="connect-param-headers"><span class="type-annotation"><a href="dart-core/Map-class.html">Map</a><span class="signature">&lt;<wbr/><span class="type-parameter"><a href="dart-core/String-class.html">String</a></span>, <span class="type-parameter">dynamic</span>&gt;</span>?</span> <span class="parameter-name">headers</span>}</span></li>
</ol>)

      <div class="features"><span class="feature">override</span></div>

    </section>
    
<section class="desc markdown">
  <p>Connects to a Flutter application.</p>
<p>See <a href="flutter_driver/FlutterDriver/connect.html">FlutterDriver.connect</a> for more documentation.</p>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">static Future&lt;FlutterDriver&gt; connect({
  String? dartVmServiceUrl,
  bool printCommunication = false,
  bool logCommunicationToFile = true,
  int? isolateNumber,
  Pattern? fuchsiaModuleTarget,
  Map&lt;String, dynamic&gt;? headers,
}) async {
  // If running on a Fuchsia device, connect to the first isolate whose name
  // matches FUCHSIA_MODULE_TARGET.
  //
  // If the user has already supplied an isolate number/URL to the Dart VM
  // service, then this won&#39;t be run as it is unnecessary.
  if (Platform.isFuchsia &amp;&amp; isolateNumber == null) {
    // TODO(awdavies): Use something other than print. On fuchsia
    // `stderr`/`stdout` appear to have issues working correctly.
    driverLog = (String source, String message) {
      print(&#39;$source: $message&#39;); // ignore: avoid_print
    };
    fuchsiaModuleTarget ??= Platform.environment[&#39;FUCHSIA_MODULE_TARGET&#39;];
    if (fuchsiaModuleTarget == null) {
      throw DriverError(
          &#39;No Fuchsia module target has been specified.\n&#39;
          &#39;Please make sure to specify the FUCHSIA_MODULE_TARGET &#39;
          &#39;environment variable.&#39;
      );
    }
    final fuchsia.FuchsiaRemoteConnection fuchsiaConnection = await FuchsiaCompat.connect();
    final List&lt;fuchsia.IsolateRef&gt; refs = await fuchsiaConnection.getMainIsolatesByPattern(fuchsiaModuleTarget);
    if (refs.isEmpty) {
      throw DriverError(&#39;Failed to get any isolate refs!&#39;);
    }
    final fuchsia.IsolateRef ref = refs.first;
    isolateNumber = ref.number;
    dartVmServiceUrl = ref.dartVm.uri.toString();
    await fuchsiaConnection.stop();
    FuchsiaCompat.cleanup();
  }

  dartVmServiceUrl ??= Platform.environment[&#39;VM_SERVICE_URL&#39;];

  if (dartVmServiceUrl == null) {
    throw DriverError(
        &#39;Could not determine URL to connect to application.\n&#39;
        &#39;Either the VM_SERVICE_URL environment variable should be set, or an explicit &#39;
        &#39;URL should be provided to the FlutterDriver.connect() method.&#39;
    );
  }

  // Connect to Dart VM services
  _log(&#39;Connecting to Flutter application at $dartVmServiceUrl&#39;);
  final vms.VmService client = await vmServiceConnectFunction(dartVmServiceUrl, headers);

  Future&lt;vms.IsolateRef?&gt; waitForRootIsolate() async {
    bool checkIsolate(vms.IsolateRef ref) =&gt; ref.number == isolateNumber.toString();
    while (true) {
      final vms.VM vm = await client.getVM();
      if (vm.isolates!.isEmpty || (isolateNumber != null &amp;&amp; !vm.isolates!.any(checkIsolate))) {
        await Future&lt;void&gt;.delayed(_kPauseBetweenReconnectAttempts);
        continue;
      }
      return isolateNumber == null
        ? vm.isolates!.first
        : vm.isolates!.firstWhere(checkIsolate);
    }
  }

  // Refreshes the isolate state periodically until the isolate reports as
  // being runnable.
  Future&lt;vms.Isolate&gt; waitForIsolateToBeRunnable(vms.IsolateRef ref) async {
    while (true) {
      final vms.Isolate isolate = await client.getIsolate(ref.id!);
      if (isolate.pauseEvent!.kind == vms.EventKind.kNone) {
        await Future&lt;void&gt;.delayed(_kPauseBetweenIsolateRefresh);
      } else {
        return isolate;
      }
    }
  }

  final vms.IsolateRef isolateRef = (await _warnIfSlow&lt;vms.IsolateRef?&gt;(
    future: waitForRootIsolate(),
    timeout: kUnusuallyLongTimeout,
    message: isolateNumber == null
      ? &#39;The root isolate is taking an unusually long time to start.&#39;
      : &#39;Isolate $isolateNumber is taking an unusually long time to start.&#39;,
  ))!;
  _log(&#39;Isolate found with number: ${isolateRef.number}&#39;);
  final vms.Isolate isolate = await _warnIfSlow&lt;vms.Isolate&gt;(
    future: waitForIsolateToBeRunnable(isolateRef),
    timeout: kUnusuallyLongTimeout,
    message: &#39;The isolate ${isolateRef.number} is taking unusually long time &#39;
        &#39;to initialize. It still reports ${vms.EventKind.kNone} as pause &#39;
        &#39;event which is incorrect.&#39;,
  );

  final VMServiceFlutterDriver driver = VMServiceFlutterDriver.connectedTo(
    client,
    isolate,
    printCommunication: printCommunication,
    logCommunicationToFile: logCommunicationToFile,
  );

  // Attempts to resume the isolate, but does not crash if it fails because
  // the isolate is already resumed. There could be a race with other tools,
  // such as a debugger, any of which could have resumed the isolate.
  Future&lt;vms.Success&gt; resumeLeniently() async {
    _log(&#39;Attempting to resume isolate&#39;);
    // Let subsequent isolates start automatically.
    try {
      final vms.Response result = await client.setFlag(&#39;pause_isolates_on_start&#39;, &#39;false&#39;);
      if (result == null || result.type != &#39;Success&#39;) {
        _log(&#39;setFlag failure: $result&#39;);
      }
    } catch (e) {
      _log(&#39;Failed to set pause_isolates_on_start=false, proceeding. Error: $e&#39;);
    }

    return client.resume(isolate.id!).catchError((Object e) {
      const int vmMustBePausedCode = 101;
      if (e is vms.RPCError &amp;&amp; e.code == vmMustBePausedCode) {
        // No biggie; something else must have resumed the isolate
        _log(
            &#39;Attempted to resume an already resumed isolate. This may happen &#39;
            &#39;when another tool (usually a debugger) resumed the isolate &#39;
            &#39;before the flutter_driver did.&#39;
        );
        return vms.Success();
      } else {
        // Failed to resume due to another reason. Fail hard.
        throw e; // ignore: only_throw_errors, proxying the error from upstream.
      }
    });
  }

  /// Waits for a signal from the VM service that the extension is registered.
  ///
  /// Looks at the list of loaded extensions for the current [isolateRef], as
  /// well as the stream of added extensions.
  Future&lt;void&gt; waitForServiceExtension() async {
    await client.streamListen(vms.EventStreams.kIsolate);

    final Future&lt;void&gt; extensionAlreadyAdded = client
      .getIsolate(isolateRef.id!)
      .then((vms.Isolate isolate) async {
        if (isolate.extensionRPCs!.contains(_flutterExtensionMethodName)) {
          return;
        }
        // Never complete. Rely on the stream listener to find the service
        // extension instead.
        return Completer&lt;void&gt;().future;
      });

    final Completer&lt;void&gt; extensionAdded = Completer&lt;void&gt;();
    late StreamSubscription&lt;vms.Event&gt; isolateAddedSubscription;

    isolateAddedSubscription = client.onIsolateEvent.listen(
      (vms.Event data) {
        if (data.kind == vms.EventKind.kServiceExtensionAdded &amp;&amp; data.extensionRPC == _flutterExtensionMethodName) {
          extensionAdded.complete();
          isolateAddedSubscription.cancel();
        }
      },
      onError: extensionAdded.completeError,
      cancelOnError: true,
    );

    await Future.any(&lt;Future&lt;void&gt;&gt;[
      extensionAlreadyAdded,
      extensionAdded.future,
    ]);
    await isolateAddedSubscription.cancel();
    await client.streamCancel(vms.EventStreams.kIsolate);
  }

  // Attempt to resume isolate if it was paused
  if (isolate.pauseEvent!.kind == vms.EventKind.kPauseStart) {
    _log(&#39;Isolate is paused at start.&#39;);

    await resumeLeniently();
  } else if (isolate.pauseEvent!.kind == vms.EventKind.kPauseExit ||
      isolate.pauseEvent!.kind == vms.EventKind.kPauseBreakpoint ||
      isolate.pauseEvent!.kind == vms.EventKind.kPauseException ||
      isolate.pauseEvent!.kind == vms.EventKind.kPauseInterrupted ||
      isolate.pauseEvent!.kind == vms.EventKind.kPausePostRequest) {
    // If the isolate is paused for any other reason, assume the extension is
    // already there.
    _log(&#39;Isolate is paused mid-flight.&#39;);
    await resumeLeniently();
  } else if (isolate.pauseEvent!.kind == vms.EventKind.kResume) {
    _log(&#39;Isolate is not paused. Assuming application is ready.&#39;);
  } else {
    _log(
        &#39;Unknown pause event type ${isolate.pauseEvent.runtimeType}. &#39;
        &#39;Assuming application is ready.&#39;
    );
  }

  // We will never receive the extension event if the user does not register
  // it. If that happens, show a message but continue waiting.
  await _warnIfSlow&lt;void&gt;(
    future: waitForServiceExtension(),
    timeout: kUnusuallyLongTimeout,
    message: &#39;Flutter Driver extension is taking a long time to become available. &#39;
        &#39;Ensure your test app (often &#34;lib/main.dart&#34;) imports &#39;
        &#39;&#34;package:flutter_driver/driver_extension.dart&#34; and &#39;
        &#39;calls enableFlutterDriverExtension() as the first call in main().&#39;,
  );

  final Health health = await driver.checkHealth();
  if (health.status != HealthStatus.ok) {
    await client.dispose();
    await client.onDone;
    throw DriverError(&#39;Flutter application health check failed.&#39;);
  }

  _log(&#39;Connected to Flutter application.&#39;);
  return driver;
}</code></pre>
</section>


  </div> <!-- /.main-content -->

  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled="" class="form-control typeahead" placeholder="Loading search..."/>
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
  <li><a href="index.html">Flutter</a></li>
  <li><a href="flutter_driver/flutter_driver-library.html">flutter_driver</a></li>
  <li><a href="flutter_driver/VMServiceFlutterDriver-class.html">VMServiceFlutterDriver</a></li>
  <li class="self-crumb">connect static method</li>
</ol>


    <h5>VMServiceFlutterDriver class</h5>
    <ol>

        <li class="section-title"><a href="flutter_driver/VMServiceFlutterDriver-class.html#constructors">Constructors</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/VMServiceFlutterDriver.connectedTo.html">connectedTo</a></li>


        <li class="section-title">
          <a href="flutter_driver/VMServiceFlutterDriver-class.html#instance-properties">Properties</a>
        </li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/appIsolate.html">appIsolate</a></li>
          <li class="inherited"><a href="dart-core/Object/hashCode.html">hashCode</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/logFilePathName.html">logFilePathName</a></li>
          <li class="inherited"><a href="dart-core/Object/runtimeType.html">runtimeType</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/serviceClient.html">serviceClient</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/webDriver.html">webDriver</a></li>

        <li class="section-title"><a href="flutter_driver/VMServiceFlutterDriver-class.html#instance-methods">Methods</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/checkHealth.html">checkHealth</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/clearTimeline.html">clearTimeline</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/close.html">close</a></li>
          <li class="inherited"><a class="deprecated" href="flutter_driver/FlutterDriver/enableAccessibility.html">enableAccessibility</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/enterText.html">enterText</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/forceGC.html">forceGC</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getBottomLeft.html">getBottomLeft</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getBottomRight.html">getBottomRight</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getCenter.html">getCenter</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getLayerTree.html">getLayerTree</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getRenderObjectDiagnostics.html">getRenderObjectDiagnostics</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getRenderTree.html">getRenderTree</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getSemanticsId.html">getSemanticsId</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getText.html">getText</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getTopLeft.html">getTopLeft</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getTopRight.html">getTopRight</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/getVmFlags.html">getVmFlags</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/getWidgetDiagnostics.html">getWidgetDiagnostics</a></li>
          <li class="inherited"><a href="dart-core/Object/noSuchMethod.html">noSuchMethod</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/requestData.html">requestData</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/runUnsynchronized.html">runUnsynchronized</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/screenshot.html">screenshot</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/scroll.html">scroll</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/scrollIntoView.html">scrollIntoView</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/scrollUntilVisible.html">scrollUntilVisible</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/sendCommand.html">sendCommand</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/sendTextInputAction.html">sendTextInputAction</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/setSemantics.html">setSemantics</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/setTextEntryEmulation.html">setTextEntryEmulation</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/startTracing.html">startTracing</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/stopTracingAndDownloadTimeline.html">stopTracingAndDownloadTimeline</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/tap.html">tap</a></li>
          <li class="inherited"><a href="dart-core/Object/toString.html">toString</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/traceAction.html">traceAction</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/waitFor.html">waitFor</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/waitForAbsent.html">waitForAbsent</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/waitForCondition.html">waitForCondition</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/waitForTappable.html">waitForTappable</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/waitUntilFirstFrameRasterized.html">waitUntilFirstFrameRasterized</a></li>
          <li class="inherited"><a href="flutter_driver/FlutterDriver/waitUntilNoTransientCallbacks.html">waitUntilNoTransientCallbacks</a></li>

        <li class="section-title inherited"><a href="flutter_driver/VMServiceFlutterDriver-class.html#operators">Operators</a></li>
          <li class="inherited"><a href="dart-core/Object/operator_equals.html">operator ==</a></li>



        <li class="section-title"><a href="flutter_driver/VMServiceFlutterDriver-class.html#static-methods">Static methods</a></li>
          <li><a href="flutter_driver/VMServiceFlutterDriver/connect.html">connect</a></li>

</ol>

  </div><!--/.sidebar-offcanvas-->

  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div><!--/.sidebar-offcanvas-->

</main>

<footer>
  <span class="no-break">
    Flutter
      0.0.0
  </span>

  <script src="footer.js"></script>
</footer>



<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/docs.dart.js"></script>







</body></html>